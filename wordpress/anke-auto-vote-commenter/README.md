# Anke Auto Commenter

アンケート記事に対して自動的に投票とコメントを投稿するWordPressプラグイン

## 概要

このプラグインは、`wp_anke_users`テーブルのユーザープロフィール情報を活用し、OpenAI APIを使用して自然で個性的なコメントを生成します。ユーザーの年齢、性別、職業、結婚状況、子供の有無、居住地、興味などすべての属性を考慮した、リアルなコメントを自動投稿します。

## 主要機能

### 1. 自動投票機能
- アンケート記事に対して自動的に投票
- プロフィール情報に基づいた傾向的な投票選択
- ランダム要素も含めた自然な投票パターン

### 2. 自動コメント生成
- OpenAI APIを使用した高品質なコメント生成
- ユーザープロフィールを完全に反映
  - 年齢層（10代〜50代以上）
  - 性別（男性/女性）
  - 結婚状況（独身/既婚）
  - 子供の有無と人数
  - 職業
  - 居住地（都道府県）
  - 興味カテゴリー
  - 自己紹介文
- 年齢に応じた口調の自動調整
  - 若い世代: カジュアルな口調
  - 中年世代: フレンドリーな口調
  - 高齢世代: 丁寧な口調

### 3. 実行設定
- 実行間隔設定（時間単位）
- 実行時刻のゆらぎ設定（ランダム性）
- 実行しない時間帯設定（深夜など）
- 1回の実行で処理する件数設定

### 4. コメント投稿者設定
- **ランダムモード**: `status=2`の編集者からランダムに選択
- **固定モード**: 指定したユーザーのみ使用

### 5. コメント生成設定
- コメント文字数の範囲設定
- プロフィール考慮度（高/中/低）

## 必要要件

- WordPress 5.0以上
- PHP 7.4以上
- Anke Auto Creatorプラグイン（OpenAI API設定を共有）
- `wp_anke_users`テーブル
- `wp_anke_votes`テーブル

## インストール

1. プラグインフォルダを`wp-content/plugins/`にアップロード
2. WordPress管理画面でプラグインを有効化
3. 「アンケ自動コメント」メニューから設定

## 設定方法

### 1. OpenAI API設定

このプラグインは「アンケ自動作成」プラグインのOpenAI API設定を共有します。
先に「アンケ自動作成」プラグインでAPI Keyとモデルを設定してください。

### 2. 基本設定

- **自動コメント機能**: チェックを入れて有効化

### 3. 実行間隔設定

- **基本間隔**: 2〜4時間を推奨
- **ゆらぎ**: 30分程度を推奨（同じ時刻に実行しないため）
- **実行しない時間帯**: 深夜0時〜6時など
- **1回の処理件数**: 3件程度を推奨

### 4. コメント投稿者設定

- **ランダムモード**: 編集者（status=2）からランダムに選択（推奨）
- **固定モード**: 特定の編集者のみ使用

### 5. コメント生成設定

- **コメント文字数**: 50〜150文字を推奨
- **プロフィール考慮度**: 高（個性を強く反映）を推奨

## 使用方法

### 自動実行

設定を保存すると、指定した間隔で自動的に実行されます。

### 手動実行

管理画面の「今すぐ実行」ボタンで即座に実行できます。

### テストコメント生成

実際に投稿せずに、コメントの生成結果をプレビューできます。

1. テストユーザーを選択
2. 記事IDを入力
3. 「テストコメント生成」ボタンをクリック

## プロフィール情報の活用例

### 年齢による傾向
- **10〜20代**: 新しいもの、トレンドに敏感
- **30〜40代**: バランス型、実用性重視
- **50代以上**: 伝統的、安定的なものを好む

### 性別による傾向
- **女性**: 美容、健康、家族関連に関心
- **男性**: テクノロジー、スポーツに関心

### 結婚状況による傾向
- **既婚**: 家族関連のトピックに関心
- **独身**: 個人的な趣味や自己投資に関心

### 職業による傾向
- **会社員**: ビジネス関連に関心
- **主婦**: 家事、節約に関心
- **学生**: 学習、就職に関心

### 子供の有無による傾向
- **子供あり**: 教育、子育てに関心
- **子供なし**: 趣味、旅行に関心

## コメント生成の仕組み

1. **プロフィール分析**: ユーザーの全属性を分析
2. **投票実行**: プロフィールに基づいた傾向的な投票
3. **ペルソナ構築**: 年齢、性別、職業、家族構成などを統合
4. **口調決定**: 年齢に応じた自然な口調を選択
5. **プロンプト生成**: 詳細なペルソナ情報を含むプロンプト
6. **OpenAI API呼び出し**: GPT-4o-miniで高品質なコメント生成
7. **コメント投稿**: 自動承認で即座に公開

## データベース構造

### wp_anke_users
コメント投稿者の情報源

- `id`: ユーザーID
- `user_nicename`: ニックネーム
- `user_email`: メールアドレス
- `birth_years`: 生まれ年
- `sex`: 性別（male/female）
- `marriage`: 結婚状況（single/married）
- `child_count`: 子供の人数
- `job`: 職業
- `prefecture`: 居住地
- `user_description`: 自己紹介
- `interest_categories`: 興味カテゴリー（JSON）

### wp_anke_votes
投票データ

- `post_id`: 記事ID
- `user_id`: ユーザーID
- `vote_value`: 投票値
- `vote_label`: 投票ラベル
- `voted_at`: 投票日時

### wp_comments
コメントデータ（WordPress標準）

## トラブルシューティング

### コメントが生成されない

1. OpenAI API Keyが正しく設定されているか確認
2. 対象記事に投票選択肢があるか確認
3. エラーログを確認（`/wp-content/debug.log`）

### 同じユーザーが複数回コメントする

- 既に投票・コメント済みのチェックが機能しています
- データベースの重複チェックを確認してください

### コメントが不自然

- プロフィール考慮度を「高」に設定
- コメント文字数を50〜150文字に設定
- OpenAIモデルを`gpt-4o-mini`以上に設定

## ライセンス

GPL v2 or later

## サポート

問題が発生した場合は、エラーログを確認してください。

## 更新履歴

### 1.0.0 (2025-11-17)
- 初回リリース
- 自動投票機能
- 自動コメント生成機能
- プロフィール完全対応
- 実行間隔設定
- 手動実行機能
- テストコメント生成機能
