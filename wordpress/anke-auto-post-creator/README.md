# Anke Auto Creator

ニュース記事から自動でアンケートを作成するWordPressプラグイン

## 機能

### 1. URLスクレイピング
- 最大10個のURLを登録可能
- RSS/Atom、Yahoo!ニュース、一般的なニュースサイトに対応
- 記事のタイトル、本文、画像、公開日を自動抽出

### 2. ChatGPT連携
- OpenAI GPT-4o-miniを使用
- 記事内容からアンケート質問を自動生成
- 選択肢2～5個を自動生成
- カテゴリ・キーワードを自動抽出

### 3. 自動投稿
- wp_anke_usersのstatus=3（編集者）を質問者として設定
- ランダムまたは固定の質問者を選択可能
- 投票オプション、カテゴリ、キーワードを自動設定
- アイキャッチ画像を自動設定

### 4. スケジュール実行
- WP-Cronで自動実行
- 実行間隔: 1～24時間（デフォルト: 1時間）
- ゆらぎ: ±0～60分（デフォルト: ±15分）
- 作成しない時間帯を設定可能（例: 深夜0時～6時）
- 1回の実行で1件のアンケートを作成

### 5. 重複チェック
- 記事URLで重複確認
- 同じ記事から複数のアンケートを作成しない
- 処理済みURLをデータベースに記録

## インストール

1. プラグインフォルダに配置
2. WordPress管理画面でプラグインを有効化
3. 「アンケ自動作成」メニューから設定

## 設定項目

### スクレイピングURL
- URL 1～10: ニュース記事を取得するURL

### OpenAI API設定
- API Key: ChatGPT APIキー（https://platform.openai.com/api-keys）

### 実行間隔設定
- 基本間隔: 1～24時間
- ゆらぎ: ±0～60分
- 作成しない時間帯: 開始時刻～終了時刻

### 質問者設定
- AI会員の使用確率: 0～100%
- status=2（編集者）またはstatus=6（AI会員）からランダムに選択
- 設定した確率でAI会員が使用され、残りの確率で編集者が使用される

### スクレイピング設定
- 待機時間: 各URL間のランダムな待機時間（10～300秒）

## 使用方法

### 自動実行
プラグインを有効化すると、設定した間隔で自動的にアンケートが作成されます。

### 手動実行
管理画面の「今すぐ実行」ボタンで即座にアンケートを作成できます。

## データベーステーブル

### wp_anke_auto_creator_processed
処理済みURL記録テーブル

- id: 連番
- source_url: スクレイピング元URL
- article_url: 記事URL（UNIQUE）
- article_title: 記事タイトル
- post_id: 作成された投稿ID
- created_at: 作成日時

## 技術仕様

- PHP 7.4以上
- WordPress 5.0以上
- OpenAI API（GPT-4o-mini）
- DOMDocument/DOMXPath（HTMLパース）
- WP-Cron（スケジュール実行）

## ライセンス

GPL v2 or later

## 作者

Anke Team
